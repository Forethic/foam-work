## 验证码专题

### 1. 验证码简介

![image-20220830221204749](C:\Users\XL\AppData\Roaming\Typora\typora-user-images\image-20220830221204749.png)

**注：**重点是识别滑块缺口，测出需要拖动的距离

#### 1.1 **核心步骤**

1. 从服务器随机取一张图片，并对图片上的随机`x,y`坐标和宽高一块区域抠图；
2. 根据步骤一的坐标和宽高，使用二维数组保存原图上抠图区域的像素点坐标；
3. 根据步骤二的坐标点，对原图的抠图区域的颜色进行处理。
4. 完成以上步骤之后得到两张图(扣下来的方块图，带有抠图区域阴影的原图),将这两张图和抠图区域的y坐标传到前台，前端在移动方块验证时，将移动后的x坐标传递到后台与原来的x坐标作比较，如果在阈值内则验证通过。
5. **请求验证的步骤**：前台向后台发起请求，后台随机一张图片做处理将处理完的两张图片的`base64`，抠图y坐标和`token`(token为后台缓存验证码的唯一`token`,可以用缓存和分布式缓存)返回给前台。
6. 前台滑动图片将`x`坐标和`token`作为参数请求后台验证，服务器根据`token`取出`x`坐标与参数的x进行比较。



#### 1.2 突破规则

这类验证码可以使用 `selenium` 操作浏览器拖拽滑块来进行破解，难点两个，一个如何确定拖拽到的位置，另一个是避开人机识别（反爬虫）。

首先我们先看看，**确定滑块验证码需要拖拽的位移距离**

**有三种方式**

- 人工智能机器学习，确定滑块位置    
- 通过完整图片与缺失滑块的图片进行像素对比，确定滑块位置
- 花钱找人识别

各有优缺点。人工智能机器学习，确定滑块位置，需要进行训练比较麻烦，所以我们主要看后面两种。

**对比完整图片与缺失滑块的图片**



#### 1.3 常见验证码平台介绍

易盾：https://dun.163.com/product/captcha?from=baiduP2_YZM_CP4183

顶象：https://www.dingxiang-inc.com/business/captcha

同盾：https://xiaodun.com/onlineExperience/slidingPuzzle

数美：https://www.ishumei.com/

VAPTCHA：https://www.vaptcha.com/?lang=cn&from=0

极验：https://www.geetest.com/show

腾讯：https://007.qq.com/

阿里：https://we.51job.com/api/job/search-pc?api_key=51job&timestamp=1694777773&keyword=java&searchType=2&function=&industry=&jobArea=000000&jobArea2=&landmark=&metro=&salary=&workYear=&degree=&companyType=&companySize=&jobType=&issueDate=&sortType=0&pageNum=2&requestId=f6e64a68f0c18cd69f676f36a687a233&pageSize=20&source=1&accountId=&pageCode=sou%7Csou%7Csoulb

谷歌：https://www.google.com/recaptcha/api2/demo

AJ :  小公司喜欢用 开源的  只有2种 滑块 点选

地址：https://jnt.mfu.com.cn/page/tg   免费不要钱     AJ验证码  没有轨迹

自己公司写的验证码，这种最简单

`recaptcha  hcaptcha  funcaptcha` 三剑客

解决方案：https://www.yescaptcha.com/auth/register   专业破谷歌

 

#### 1.4 验证码图片处理

+ 站点:https://www.geetest.com/demo/

+ 使用浏览器技术提取滑块图片，进行处理

```python
# 保存图片
import base64,io
images = q_qt.split(',')[1]
images = base64.b64decode(images)
images = Image.open(io.BytesIO(images))
images.save('q_qg.png')
```



#### 1.4 背景滑块识别一

+ 这里使用开源的技术`ddddocr`进行滑块的识别

```python
import ddddocr
def text_dis():
    slide = ddddocr.DdddOcr(det=False, ocr=False)
    with open('bg.png', 'rb') as f:
        target_bytes = f.read()
    with open('zg.png', 'rb') as f:
        background_bytes = f.read()
    res = slide.slide_comparison(target_bytes, background_bytes)
    print(res)
```



#### 1.5 背景滑块识别二

地址：http://www.chaojiying.com/api-5.html

类别: http://www.chaojiying.com/price.html

地址：https://zhuce.jfbym.com/?bd_vid=7537823361963195239



### 2  极验滑块实战

+ 使用自动化过滑块

```python
链接：https://pan.baidu.com/s/1zR2fIvO2iyC3esraWWYIvw 
提取码：1234
```



### 3 手撕验证码协议分析



















