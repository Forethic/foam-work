# Wednesday, July 03, 2024

## Done List

- [ ] 修改Excel月历 适配7月份
- [x] 09 数据存储2

## 学习笔记

### 使用 aiohttp 获取豆瓣电影标题

### windows系统下运行asyncio代码模板

### aiomysql的简单使用

aiomysql 是 pymysql 的增强版
print(cursor.description) 可以使用这个方法查询表中的字段信息
关闭游标，必须使用 await
关闭数据库，不要使用 await --> 为什么？
> 这是因为，从aiomysql的设计上来看，Connection.close() 方法实际上只是将关闭操作标记为待处理，并不直接执行网络IO操作进行关闭连接。
> 这意味着，当close方法被调用时，它仅仅是将关闭请求放到了事件循环中，真正的关闭操作会在后续合适的时机异步执行。
> 这与直接执行的SQL查询不同，后者需要立即发送查询到服务器并等待响应，因此需要用await来挂起当前的任务，直到收到响应。
> 如果为了确保连接关闭，可以使用异步上下文管理器

### 使用异步上下文管理器控制数据库连接

### 使用异步爬虫完成汽车之家

> 识别静态网站还是动态网站
> 1. 页面源代码
> 2. 点击翻页，URL是否发生变化，没有变化就是静态
> 3. 滚动加载新的数据，动态
> chardet 新的包，用于判断页面编码
> 汽车之家 反爬策略--返回的页面的编码发生变化，并且不存在数据，可以用于判断是否触发了反爬 
> create table if not exist 在异步情况会报错，mysql

[text](https://www.che168.com/china/a0_0msdgscncgpi1ltocsp7exf4x0/?pvareaid=102179#currengpostion)

> 异步代理 --> 快代理

代码流程
1. 异步创建数据库连接池（数据库必须先存在）
2. 如果表不存在，创建表
3. 从数据库 爬取汽车之家获取每个 汽车的 specid，根据编码的不同确认是否被反爬
4. 获取到specid 之后，通过api 获取json数据，提取数据为字典
5. 字典转成md5，通过redis进行数据去重
6. 没有重复的数据，保存到数据库